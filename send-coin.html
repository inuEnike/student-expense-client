<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finance Tracker</title>
    <link href="./dist/styles/output.css" rel="stylesheet" />
    <script src="https://kit.fontawesome.com/14bfa6f5f3.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* Custom scrollbar styles for transaction history table */
        .transaction-history-scrollbar::-webkit-scrollbar {
            width: 8px;
            /* Width of vertical scrollbar */
            height: 8px;
            /* Height of horizontal scrollbar */
        }

        .transaction-history-scrollbar::-webkit-scrollbar-thumb {
            background-color: #888;
            /* Color of the scroll thumb */
            border-radius: 4px;
            /* Rounded corners for the thumb */
        }

        .transaction-history-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #555;
            /* Color of the thumb on hover */
        }

        .transaction-history-scrollbar::-webkit-scrollbar-track {
            background-color: #f1f1f1;
            /* Color of the track */
            border-radius: 4px;
            /* Rounded corners for the track */
        }

        /* For Firefox */
        .transaction-history-scrollbar {
            scrollbar-width: thin;
            /* Thin scroll bars */
            scrollbar-color: #888 #f1f1f1;
            /* Thumb color and track color */
        }

        /* Additional styles */
        body {
            padding-bottom: 60px;
            /* Height of the footer */
        }
    </style>
</head>

<body class="relative">
    <div class="px-3 pb-16">
        <div class="">
            <!-- Header with Logo and Icons -->
            <div class="rounded-b-md flex py-5 justify-between px-2 items-center">
                <div class="logo flex items-center">
                    <img class="mx-auto h-10 w-auto pr-2"
                        src="https://tailwindui.com/img/logos/mark.svg?color=blue&shade=600" alt="Your Company">

                    <h2 class="text-xl font-bold text-green-800">Finance Tracker</h2>
                </div>
                <div class="flex items-center">
                    <a href="/user.html">
                        <i class="fa-regular fa-user pr-3"></i>
                    </a>
                    <i class="fa-regular fa-bell"></i>
                </div>
            </div>
        </div>

        <div class="hello">
            <h2 class="text-xl text-[#3c4ee0] font-semibold">Send Coin</h2>
            <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
                <form class="space-y-6 form" method="post">

                    <div>
                        <div class="flex items-center justify-between">
                            <label for="amount" class="block text-sm font-medium leading-6 text-gray-900">Amount</label>
                            <div class="text-sm">
                            </div>
                        </div>

                        <div class="mt-2">
                            <input id="amount" name="amount" type="number" required
                                class=" px-3 amount block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6">
                        </div>
                    </div>

                    <div>
                        <div class="flex items-center justify-between">
                            <label for="matno" class="block text-sm font-medium leading-6 text-gray-900">Recipient
                                <span><small><i>Receiver's matriculation number</i></small></span></label>
                            <div class="text-sm">
                            </div>
                        </div>

                        <div class="mt-2">
                            <input id="rece" name="matno" type="text" required
                                class=" px-3 matno block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6">
                        </div>
                    </div>
                    <!-- <div>
                        <div class="flex items-center justify-between">
                            <label for="from" class="block text-sm font-medium leading-6 text-gray-900">From</label>
                            <div class="text-sm">
                            </div>
                        </div>

                        <div class="mt-2">
                            <input id="from" name="from" type="text" hidden required
                                class=" px-3 from block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6">
                        </div>
                    </div> -->

                    <div>
                        <div class="flex items-center justify-between">
                            <label for="pin" class="block text-sm font-medium leading-6 text-gray-900">Pin</label>
                            <div class="text-sm">
                            </div>
                        </div>

                        <div class="mt-2">
                            <input id="pin" name="pin" type="password" required
                                class=" px-3 pin block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6">
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between">
                            <label for="description"
                                class="block text-sm font-medium leading-6 text-gray-900">Description</label>
                            <div class="text-sm">
                            </div>
                        </div>

                        <div class="mt-2">
                            <textarea name="description rows=" 15" id=""
                                class="px-3 description block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6"></textarea>
                        </div>
                    </div>

                    <div>
                        <button type="submit"
                            class="btn flex w-full justify-center rounded-md bg-[#3c4ee0] px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">Proceed</button>
                    </div>
                    <div class="">
                        <p class="error text-red-500 text-sm"></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bottom Bar -->
    <div class="bottom-bar fixed w-full bottom-0 grid grid-cols-3 bg-slate-200 px-5 py-3 rounded-t-xl gap-4">
        <a href="/" class="flex items-center flex-col ">
            <i class="fa-solid fa-house text-lg text-blue-400"></i>
            <span class="ml-1 text-sm">Home</span>
        </a>

        <a href="/settings.html" class="flex items-center flex-col ">
            <i class="fa-solid fa-gear text-lg text-blue-400"></i>
            <span class="ml-1 text-sm">Settings</span>
        </a>
        <a href="/about.html" class="flex items-center flex-col ">
            <i class="fa-solid fa-question-circle text-lg text-blue-400"></i>
            <span class="ml-1 text-sm">About</span>
        </a>
    </div>



    <!-- JavaScript for toggling balance visibility -->
    <script src="./src/js/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            let token = localStorage.getItem("auth");

            // Fetch user data
            const getUser = await axios.get("https://student-expense-tracker-lewk.onrender.com/api/v1/auth/get-user", {
                headers: {
                    Authorization: `Bearer ${token}`
                }
            });

            console.log(getUser);

            const handleSubmit = async (e) => {
                e.preventDefault();

                const btn = document.querySelector(".btn");
                const errorElement = document.querySelector(".error");

                // Start loading state
                btn.innerHTML = "Loading...";

                // Get input values
                const amountInput = document.querySelector(".amount");
                const pinInput = document.querySelector(".pin").value;
                const recipient = document.querySelector(".matno").value;
                const description = document.querySelector(".description").value;

                // Convert input values
                const amount = parseFloat(amountInput.value); // Convert to number
                const pin = parseInt(pinInput, 10); // Convert pin to number
                console.log('Pin:', pin, 'Type:', typeof (pin));

                if (isNaN(amount) || amount <= 0) { // Ensure amount is a positive number
                    alert("Please enter a valid amount");
                    btn.innerHTML = "Buy";
                    return;
                }

                if (isNaN(pin)) { // Ensure pin is a number
                    alert("Please enter a valid pin");
                    btn.innerHTML = "Buy";
                    return;
                }

                try {
                    // Send the request to buy coin
                    const response = await axios.post('https://student-expense-tracker-lewk.onrender.com/api/v1/transaction/send-coin', {
                        amount, // Send as number
                        from: getUser.data._id,
                        matno: recipient,
                        description,
                        pin
                    }, {
                        headers: {
                            Authorization: `Bearer ${token}`
                        }
                    });

                    window.location.href = '/index.html'

                } catch (error) {
                    console.error("Error:", error.response ? error.response.data : error);
                    errorElement.innerHTML = error.response?.data?.errormessage || "An error occurred";
                    setTimeout(() => {
                        errorElement.innerHTML = ""; // Clear error message after 7 seconds
                    }, 7000);
                } finally {
                    // Reset loading state
                    btn.innerHTML = "Proceed";
                }
            };

            const form = document.querySelector('.form');
            form.addEventListener("submit", handleSubmit);
        });
    </script>

</body>

</html>