<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finance Tracker</title>
    <link href="./dist/styles/output.css" rel="stylesheet" />
    <script src="https://kit.fontawesome.com/14bfa6f5f3.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* Custom scrollbar styles for transaction history table */
        .transaction-history-scrollbar::-webkit-scrollbar {
            width: 8px;
            /* Width of vertical scrollbar */
            height: 8px;
            /* Height of horizontal scrollbar */
        }

        .transaction-history-scrollbar::-webkit-scrollbar-thumb {
            background-color: #888;
            /* Color of the scroll thumb */
            border-radius: 4px;
            /* Rounded corners for the thumb */
        }

        .transaction-history-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #555;
            /* Color of the thumb on hover */
        }

        .transaction-history-scrollbar::-webkit-scrollbar-track {
            background-color: #f1f1f1;
            /* Color of the track */
            border-radius: 4px;
            /* Rounded corners for the track */
        }

        /* For Firefox */
        .transaction-history-scrollbar {
            scrollbar-width: thin;
            /* Thin scroll bars */
            scrollbar-color: #888 #f1f1f1;
            /* Thumb color and track color */
        }

        /* Additional styles */
        body {
            padding-bottom: 60px;
            /* Height of the footer */
        }
    </style>
</head>

<body class="relative">
    <div class="px-3 pb-16">
        <div class="">
            <!-- Header with Logo and Icons -->
            <div class="rounded-b-md flex py-5 justify-between px-2 items-center">
                <div class="logo flex items-center">
                    <img class="mx-auto h-10 w-auto pr-2"
                        src="https://tailwindui.com/img/logos/mark.svg?color=blue&shade=600" alt="Your Company">

                    <h2 class="text-xl font-bold text-green-800">Finance Tracker</h2>
                </div>
                <div class="flex">
                    <i class="fa-regular fa-user pr-3"></i>
                    <i class="fa-regular fa-bell"></i>
                </div>
            </div>
        </div>

        <div class="hello">
            <!-- <h2 class="text-xl text-[#3c4ee0] font-semibold">
                <i class="fa-solid fa-gear text-lg text-blue-400" aria-hidden="true"></i>
                Settings
            </h2> -->
            <ul class="my-5 ">
                <li class="py-5 font-semibold">
                    <i class="fa-solid fa-home text-[#3c4ee0] py-5 mr-3 text-lg"></i>
                    Home
                </li>
                <li class="py-5 font-semibold">
                    <i class="fa-solid fa-paper-plane text-[#3c4ee0] py-5 mr-3 text-lg"></i>
                    Send Coin
                </li>
                <li class="py-5 font-semibold">
                    <i class="fa-solid fa-dollar-sign text-[#3c4ee0] py-5 mr-3 text-lg"></i>
                    Buy Coin
                </li>
                <li class="py-5 font-semibold">
                    <i class="fa-solid fa-exclamation-circle text-[#3c4ee0] py-5 mr-3 text-lg"></i>
                    Log a Complaint
                </li>
                <li class="py-5 font-semibold">
                    <i class="fa-solid fa-user-slash text-[#3c4ee0] py-5 mr-3 text-lg"></i>
                    Delete Account
                </li>
                <li class="py-5 font-semibold cursor-pointer" onclick="logout()">
                    <i class="fa-solid fa-right-from-bracket text-[#3c4ee0] py-5 mr-3"></i>
                    Logout
                </li>
            </ul>


        </div>
    </div>

    <!-- Bottom Bar -->
    <div class="bottom-bar fixed w-full bottom-0 grid grid-cols-4 bg-slate-200 px-5 py-3 rounded-t-xl gap-4">
        <a href="/" class="flex items-center flex-col ">
            <i class="fa-solid fa-house text-lg text-blue-400"></i>
            <span class="ml-1 text-sm">Home</span>
        </a>
        <a href="/search.html" class="flex items-center flex-col ">
            <i class="fa-solid fa-search text-lg text-blue-400"></i>
            <span class="ml-1 text-sm">Search</span>
        </a>
        <a href="/settings.html" class="flex items-center flex-col ">
            <i class="fa-solid fa-gear text-lg text-blue-400"></i>
            <span class="ml-1 text-sm">Settings</span>
        </a>
        <a href="/help.html" class="flex items-center flex-col ">
            <i class="fa-solid fa-question-circle text-lg text-blue-400"></i>
            <span class="ml-1 text-sm !text-green-600">Help</span>
        </a>
    </div>



    <!-- JavaScript for toggling balance visibility -->
    <script src="./src/js/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const handleSubmit = async (e) => {
                e.preventDefault();

                const btn = document.querySelector(".btn");
                const errorElement = document.querySelector(".error");

                // Start loading state
                btn.innerHTML = "Loading...";

                // Get input values
                const amountInput = document.querySelector(".amount");
                const amount = parseFloat(amountInput.value); // Convert to number
                let token = localStorage.getItem("auth");

                if (isNaN(amount) || amount <= 0) { // Ensure amount is a positive number
                    alert("Please enter a valid amount");
                    btn.innerHTML = "Buy";
                    return;
                }

                try {
                    // Fetch user data
                    const getUser = await axios.get("https://student-expense-tracker-lewk.onrender.com/api/v1/auth/get-user", {
                        headers: {
                            Authorization: `Bearer ${token}`
                        }
                    });

                    // Send the request to buy coin
                    const response = await axios.post('https://student-expense-tracker-lewk.onrender.com/api/v1/coin/buy-coin', {
                        amount, // Send as number
                        userId: getUser.data._id,
                    }, {
                        headers: {
                            Authorization: `Bearer ${token}`
                        }
                    });

                    console.log(response);

                    // Handle successful response
                    if (response.status === 201) {
                        const paystack = response.data?.response.data.authorization_url
                        window.location.href = paystack; // Redirect after successful transaction
                    } else {
                        // Show error message from server
                        errorElement.innerHTML = response?.data?.errormessage || "Transaction failed";
                        setTimeout(() => {
                            errorElement.innerHTML = ""; // Clear error message after 7 seconds
                        }, 7000);
                    }
                } catch (error) {
                    console.error("Error:", error);
                    errorElement.innerHTML = error.response?.data?.errMessage || "An error occurred";
                    setTimeout(() => {
                        errorElement.innerHTML = ""; // Clear error message after 7 seconds
                    }, 7000);
                } finally {
                    // Reset loading state
                    btn.innerHTML = "Buy";
                }
            };

            const form = document.querySelector('.form');
            form.addEventListener("submit", handleSubmit);
        });
    </script>

</body>

</html>